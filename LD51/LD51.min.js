H5.assemblyVersion("LD51","1.0.0.0");H5.assembly("LD51",function($asm,globals){"use strict";H5.define("LD51.MainScene",{inherits:[JuiceboxEngine.Scene],statics:{fields:{ICE_SMELT_TIME:0},ctors:{init:function(){this.ICE_SMELT_TIME=10}}},fields:{_player:null,_arrow:null,_controller:null,_playerSprite:null,_timerUI:null,_scoreUI:null,_timer:0,_hasControl:!1,_deliveries:0,_score:0,_topPanel:null,_bottomPanel:null,_people:null,_currentPerson:null,_backgroundAudio:null,_timerAudio:null,_currentLevel:0},ctors:{ctor:function(manager){this.$initialize();JuiceboxEngine.Scene.ctor.call(this,manager);this._people=new(System.Collections.Generic.List$1(LD51.PersonComponent).ctor)}},methods:{InitializeScene:function(){var personSystem=new LD51.PersonComponentSystem,level,wallPlayerMaterial,arrowSprite;this.ComponentManager.AddComponentSystem(personSystem);personSystem.addOnPersonCreate(H5.fn.cacheBind(this,this.PersonCreate));this.DefaultCamera.ClearColor=new JuiceboxEngine.Math.Color.$ctor2(30,144,255,255);this.DefaultCamera.Zoom=2;JuiceboxEngine.Graphics.GraphicsManager.Instance.Context.UseDepth(!0);level=this.ResourceManager.Load(JuiceboxEngine.Level,"Levels/CityMap.json");level.LoadToScene(this);this._backgroundAudio=this.GetGameObjectByName("Music").GetComponent(JuiceboxEngine.Audio.AudioComponent);this._timerAudio=this.GetGameObjectByName("Timer").GetComponent(JuiceboxEngine.Audio.AudioComponent);this.PhysicsWorld.Gravity=new JuiceboxEngine.Math.Vector2.$ctor3(0,0);wallPlayerMaterial=this.PhysicsWorld.CreateContactMaterial(new JuiceboxEngine.Physics.P2Material.$ctor1("wall"),new JuiceboxEngine.Physics.P2Material.$ctor1("player"));wallPlayerMaterial.Friction=0;this._player=this.GetGameObjectByName("Player");this._player.GetComponent(JuiceboxEngine.Physics.P2PhysicsComponent).addOnCollisionStay(H5.fn.cacheBind(this,this.PlayerCollisionStay));this._controller=new LD51.PlayerController(this._player.GetComponent(JuiceboxEngine.Physics.P2PhysicsComponent));this._playerSprite=this._player.GetComponent(JuiceboxEngine.Components.LayeredSpriteComponent);this._arrow=this.AddGameObject$1("Arrow");arrowSprite=this._arrow.AddComponent(JuiceboxEngine.Components.SpriteComponent);arrowSprite.Offset=new JuiceboxEngine.Math.Vector2.$ctor3(0,32);arrowSprite.Texture=this.ResourceManager.Load(JuiceboxEngine.Graphics.Texture2D,"Textures/Arrow.png");this.PlayLevelAudio(1);this._topPanel=new JuiceboxEngine.GUI.Panel(this.GUI.Root);this._topPanel.Dimensions=new JuiceboxEngine.Math.Vector2.$ctor3(1e4,32);this._topPanel.Anchor=JuiceboxEngine.GUI.UIDefaults.TopLeft.$clone();this._topPanel.Pivot=JuiceboxEngine.GUI.UIDefaults.BottomLeft.$clone();this._topPanel.Color=JuiceboxEngine.Math.Color.Black.$clone();this._bottomPanel=new JuiceboxEngine.GUI.Panel(this.GUI.Root);this._bottomPanel.Dimensions=new JuiceboxEngine.Math.Vector2.$ctor3(1e4,32);this._bottomPanel.Anchor=JuiceboxEngine.GUI.UIDefaults.BottomLeft.$clone();this._bottomPanel.Pivot=JuiceboxEngine.GUI.UIDefaults.TopLeft.$clone();this._bottomPanel.Color=JuiceboxEngine.Math.Color.Black.$clone();this._timerUI=new LD51.TimerUI(this.GUI.Root);this._timerUI.Anchor=JuiceboxEngine.GUI.UIDefaults.TopCenter.$clone();this._timerUI.Pivot=JuiceboxEngine.GUI.UIDefaults.TopCenter.$clone();this._timerUI.Position=new JuiceboxEngine.Math.Vector2.$ctor3(0,-8);this._scoreUI=new LD51.ScoreUI(this.GUI.Root);this._scoreUI.Pivot=JuiceboxEngine.GUI.UIDefaults.BottomCenter.$clone();this._scoreUI.Anchor=JuiceboxEngine.GUI.UIDefaults.BottomCenter.$clone();this.StartGame()},PersonCreate:function(personComponent){this._people.add(personComponent)},PlayerCollisionStay:function(thisBody,otherBody){this._hasControl&&(System.String.equals(otherBody.GameObject.Name,"Person")?this.TryGiveIceCream(otherBody.GameObject.GetComponent(LD51.PersonComponent)):System.String.equals(otherBody.GameObject.Name,"Restock"))},TryGiveIceCream:function(person){if(person.WantsIcecream&&this._player.GetComponent(JuiceboxEngine.Physics.P2PhysicsComponent).Velocity.Length()<.1){person.GiveIceCream();this._timer=LD51.MainScene.ICE_SMELT_TIME;JuiceboxEngine.Coroutines.CoroutineManager.StartCoroutine(this.FocusCamera());this._player.GetComponent(JuiceboxEngine.Audio.AudioComponent).Play();this._deliveries=this._deliveries+1|0;this._deliveries===10?this.PlayLevelAudio(2):this._deliveries===20&&this.PlayLevelAudio(3);var addedScore=100;this._score=this._score+addedScore|0;this._scoreUI.AddScore(addedScore);this._currentPerson=this.FindPerson();this._currentPerson.WantsIceCream()}},FocusCamera:function(){var $s=0,$jff,$rv,$ae,$en=new H5.GeneratorEnumerator(H5.fn.bind(this,function(){try{for(;;)switch($s){case 0:return this._hasControl=!1,JuiceboxEngine.Coroutines.CoroutineManager.StartCoroutine(JuiceboxEngine.Coroutines.DefaultRoutines.Linear(.5,H5.fn.bind(this,function(x){this.DefaultCamera.Zoom=2+JuiceboxEngine.Math.Easings.QuadraticEaseOut(x)*2;this._topPanel.Position=JuiceboxEngine.Math.Vector2.op_Multiply$1(new JuiceboxEngine.Math.Vector2.$ctor3(0,1),JuiceboxEngine.Math.JMath.Interpolate(0,-this._topPanel.Dimensions.Y,x));this._bottomPanel.Position=JuiceboxEngine.Math.Vector2.op_Multiply$1(new JuiceboxEngine.Math.Vector2.$ctor3(0,1),JuiceboxEngine.Math.JMath.Interpolate(0,this._bottomPanel.Dimensions.Y,x))}))),$en.current=new JuiceboxEngine.Coroutines.WaitForSeconds(1),$s=1,!0;case 1:this._hasControl=!0;this._timer=LD51.MainScene.ICE_SMELT_TIME;JuiceboxEngine.Coroutines.CoroutineManager.StartCoroutine(JuiceboxEngine.Coroutines.DefaultRoutines.Linear(.5,H5.fn.bind(this,function(x){this.DefaultCamera.Zoom=2+JuiceboxEngine.Math.Easings.QuarticEaseIn(1-x)*2;this._topPanel.Position=JuiceboxEngine.Math.Vector2.op_Multiply$1(new JuiceboxEngine.Math.Vector2.$ctor3(0,1),JuiceboxEngine.Math.JMath.Interpolate(-this._topPanel.Dimensions.Y,0,x));this._bottomPanel.Position=JuiceboxEngine.Math.Vector2.op_Multiply$1(new JuiceboxEngine.Math.Vector2.$ctor3(0,1),JuiceboxEngine.Math.JMath.Interpolate(this._bottomPanel.Dimensions.Y,0,x))})));default:return!1}}catch($ae1){$ae=System.Exception.create($ae1);throw $ae;}}));return $en},StartGame:function(){this._timer=LD51.MainScene.ICE_SMELT_TIME;this._hasControl=!0;this._deliveries=0;this.DefaultCamera.GameObject.Transform.Position2D=this._player.Transform.Position2D.$clone();this._currentPerson=this.FindPerson();this._currentPerson.WantsIceCream()},PreUpdate:function(){this._hasControl&&(this._timer-=JuiceboxEngine.Util.Time.DeltaTime,this._timerUI.UpdateTime(this._timer),this._timerAudio.Volume=this._timer<5?(3-this._timer)/3:0);this._timer<0&&(this._timer=0,this._timerUI.UpdateTime(this._timer),this._hasControl=!1);this._hasControl&&this._controller.Update();this._playerSprite.Size=JuiceboxEngine.Math.Vector2.op_Addition(new JuiceboxEngine.Math.Vector2.$ctor3(1,1),JuiceboxEngine.Math.Vector2.op_Multiply$1(JuiceboxEngine.Math.Vector2.op_Multiply$1(JuiceboxEngine.Math.Vector2.op_Multiply$1(new JuiceboxEngine.Math.Vector2.$ctor3(1,1),JuiceboxEngine.Math.JMath.Sin(JuiceboxEngine.Util.Time.TotalSeconds*50)),.02),this._controller.speed/this._controller.maxSpeed))},FindPerson:function(){return this._people.getItem(JuiceboxEngine.Math.RandomNumbers.NextRange(0,this._people.Count))},PostUpdate:function(){this._arrow.Transform.Position2D=this._player.Transform.Position2D.$clone();var dir=JuiceboxEngine.Math.Vector2.op_Subtraction(this._currentPerson.GameObject.Transform.Position2D.$clone(),this._player.Transform.Position2D.$clone());dir.Normalize();this._arrow.Transform.Rotation2D=JuiceboxEngine.Math.JMath.ATan2(dir.Y,dir.X)-JuiceboxEngine.Math.JMath.PI_OVER_TWO;this.DefaultCamera.GameObject.Transform.Position2D=JuiceboxEngine.Math.Vector2.Interpolate(this.DefaultCamera.GameObject.Transform.Position2D.$clone(),JuiceboxEngine.Math.Vector2.op_Addition(this._player.Transform.Position2D.$clone(),JuiceboxEngine.Math.Vector2.op_Multiply$1(this._player.GetComponent(JuiceboxEngine.Physics.P2PhysicsComponent).Velocity.$clone(),.25)),5*JuiceboxEngine.Util.Time.DeltaTime)},PlayLevelAudio:function(level){level=JuiceboxEngine.Math.JMath.Clamp(level,1,3);this._currentLevel=level;this._backgroundAudio.AudioClip=this.ResourceManager.Load(JuiceboxEngine.Audio.AudioClip,System.String.format("Sounds/Overworld_level_{0}.mp3",[level]));this._timerAudio.AudioClip=this.ResourceManager.Load(JuiceboxEngine.Audio.AudioClip,System.String.format("Sounds/Overworld_timer_{0}.mp3",[level]));this._player.GetComponent(JuiceboxEngine.Audio.AudioComponent).AudioClip=this.ResourceManager.Load(JuiceboxEngine.Audio.AudioClip,System.String.format("Sounds/Bliep{0}.mp3",[level]));this._backgroundAudio.Play();this._timerAudio.Play()},FinalizeScene:function(){}}});H5.define("LD51.PersonComponent",{inherits:[JuiceboxEngine.Components.Component],statics:{fields:{PERSON_DIMENSIONS:0},ctors:{init:function(){this.PERSON_DIMENSIONS=16}}},fields:{WanderDistance:null,WantsIcecream:!1,_ui:null,_setup:!1},ctors:{init:function(){this.WanderDistance=new JuiceboxEngine.Math.Vector2}},methods:{Initialize:function(){this._setup=!1;this._ui=this.GameObject.AddComponent(JuiceboxEngine.Components.UIComponent);var image=new JuiceboxEngine.GUI.Image(this.GameObject.Scene.GUI.Root);image.Pivot=JuiceboxEngine.GUI.UIDefaults.BottomCenter.$clone();image.DisplayImage=this.GameObject.Scene.ResourceManager.Load(JuiceboxEngine.Graphics.Texture2D,"Textures/IceCreamRequest.png");image.Dimensions=JuiceboxEngine.Math.Vector2.op_Multiply$1(JuiceboxEngine.Math.Vector2.op_Multiply$1(new JuiceboxEngine.Math.Vector2.$ctor3(image.DisplayImage.Width,image.DisplayImage.Height),this.GameObject.Scene.DefaultCamera.Zoom),JuiceboxEngine.Util.Config.ConfigValues.PixelSize);image.Enabled=!1;this._ui.UIElement=image},Update:function(){if(JuiceboxEngine.Components.Component.prototype.Update.call(this),!this._setup){var sprite=this.GameObject.GetComponent(JuiceboxEngine.Components.SpriteComponent);sprite.SourceRectangle=new JuiceboxEngine.Math.Rectangle.$ctor2(H5.Int.mul(JuiceboxEngine.Math.RandomNumbers.NextRange(0,4),LD51.PersonComponent.PERSON_DIMENSIONS),H5.Int.mul(JuiceboxEngine.Math.RandomNumbers.NextRange(0,4),LD51.PersonComponent.PERSON_DIMENSIONS),LD51.PersonComponent.PERSON_DIMENSIONS,LD51.PersonComponent.PERSON_DIMENSIONS);this._setup=!0}},WantsIceCream:function(){this.WantsIcecream=!0;this._ui.UIElement.Enabled=!0;JuiceboxEngine.Coroutines.CoroutineManager.StartCoroutine(JuiceboxEngine.Coroutines.DefaultRoutines.Linear(.2,H5.fn.bind(this,function(x){this._ui.UIElement.Scale=JuiceboxEngine.Math.Vector2.op_Multiply$1(new JuiceboxEngine.Math.Vector2.$ctor3(1,1),JuiceboxEngine.Math.Easings.BackEaseOut(x))})))},GiveIceCream:function(){this.WantsIcecream&&(this.WantsIcecream=!1,JuiceboxEngine.Coroutines.CoroutineManager.StartCoroutine(this.HideBubble()))},HideBubble:function(){var $s=0,$jff,$rv,$ae,$en=new H5.GeneratorEnumerator(H5.fn.bind(this,function(){try{for(;;)switch($s){case 0:return $en.current=new JuiceboxEngine.Coroutines.WaitForCoroutine.$ctor1(JuiceboxEngine.Coroutines.DefaultRoutines.Linear(.5,H5.fn.bind(this,function(x){this._ui.UIElement.Scale=JuiceboxEngine.Math.Vector2.op_Multiply$1(new JuiceboxEngine.Math.Vector2.$ctor3(1,1),JuiceboxEngine.Math.Easings.BackEaseOut(1-x))}))),$s=1,!0;case 1:this._ui.UIElement.Enabled=!1;default:return!1}}catch($ae1){$ae=System.Exception.create($ae1);throw $ae;}}));return $en},Destroy:function(){}}});H5.define("LD51.PersonComponentSystem",{inherits:[JuiceboxEngine.Components.ComponentSystem],events:{OnPersonCreate:null},ctors:{ctor:function(){this.$initialize();JuiceboxEngine.Components.ComponentSystem.ctor.call(this,LD51.PersonComponent)}},methods:{CreateComponent:function(){var person=new LD51.PersonComponent;return H5.staticEquals(this.OnPersonCreate,null)?null:this.OnPersonCreate(person),person}}});H5.define("LD51.PlayerController",{fields:{_playerPhysics:null,_playerSprite:null,speed:0,maxSpeed:0,reversing:!1,tilt:0},ctors:{ctor:function(playerPhysics){this.$initialize();this._playerPhysics=playerPhysics;this._playerPhysics.Damping=.9;this._playerSprite=playerPhysics.GameObject.GetComponent(JuiceboxEngine.Components.LayeredSpriteComponent);this.speed=0;this.maxSpeed=300;this.reversing=!1}},methods:{Update:function(){this._playerPhysics.Velocity.Length()<2&&(this.speed=0);JuiceboxEngine.Input.InputManager.Instance.IsKeyHeld("W")||JuiceboxEngine.Input.InputManager.Instance.IsKeyHeld("ArrowUp")||JuiceboxEngine.Input.InputManager.Instance.IsMouseKeyHeld(JuiceboxEngine.Input.MouseKey.LeftMouse)?(this.speed+=500*JuiceboxEngine.Util.Time.DeltaTime,this.speed>0&&(this.reversing=!1)):JuiceboxEngine.Input.InputManager.Instance.IsKeyHeld("S")||JuiceboxEngine.Input.InputManager.Instance.IsKeyHeld("ArrowDown")?this.speed<=0?(this.speed-=300*JuiceboxEngine.Util.Time.DeltaTime,this.reversing=!0):this.speed-=850*JuiceboxEngine.Util.Time.DeltaTime:this.reversing?this.speed+=300*JuiceboxEngine.Util.Time.DeltaTime:this.speed-=300*JuiceboxEngine.Util.Time.DeltaTime;this.speed=this.reversing?JuiceboxEngine.Math.JMath.Clamp$1(this.speed,-this.maxSpeed,0):JuiceboxEngine.Math.JMath.Clamp$1(this.speed,0,this.maxSpeed);this._playerPhysics.AngularVelocity=0;JuiceboxEngine.Math.JMath.Abs(this.speed)>.1&&(JuiceboxEngine.Input.InputManager.Instance.IsKeyHeld("D")||JuiceboxEngine.Input.InputManager.Instance.IsKeyHeld("ArrowRight")?this._playerPhysics.AngularVelocity=-JuiceboxEngine.Math.JMath.Interpolate(3,2,this.speed/this.maxSpeed):(JuiceboxEngine.Input.InputManager.Instance.IsKeyHeld("A")||JuiceboxEngine.Input.InputManager.Instance.IsKeyHeld("ArrowLeft"))&&(this._playerPhysics.AngularVelocity=JuiceboxEngine.Math.JMath.Interpolate(3,2,this.speed/this.maxSpeed)),this.reversing&&(this._playerPhysics.AngularVelocity*=-1));this._playerPhysics.Velocity=JuiceboxEngine.Math.Vector2.Rotate(new JuiceboxEngine.Math.Vector2.$ctor3(0,this.speed),this._playerPhysics.Rotation);this._playerSprite.Rotation=this.reversing?JuiceboxEngine.Math.JMath.Interpolate(this._playerSprite.Rotation,0,5*JuiceboxEngine.Util.Time.DeltaTime)*.8:JuiceboxEngine.Math.JMath.Interpolate(this._playerSprite.Rotation,this._playerPhysics.AngularVelocity,5*JuiceboxEngine.Util.Time.DeltaTime)*.8*(this.speed/this.maxSpeed)}}});H5.define("LD51.Program",{main:function(){var game=new JuiceboxEngine.JuiceboxGame;game.Run(new LD51.MainScene(game.ResourceManager))}});H5.define("LD51.ScoreUI",{inherits:[JuiceboxEngine.GUI.EmptyUIElement],fields:{_text:null,_score:0,_displayedScore:0},ctors:{ctor:function(parent){this.$initialize();JuiceboxEngine.GUI.EmptyUIElement.ctor.call(this,parent);this.Dimensions=new JuiceboxEngine.Math.Vector2.$ctor3(300,128);this._score=0;this._text=new JuiceboxEngine.GUI.CanvasText(this);this._text.Dimensions=this.Dimensions.$clone();this._text.HorizontalAlignment=JuiceboxEngine.GUI.TextHorizontalAlignment.Center;this._text.VerticalAlignment=JuiceboxEngine.GUI.TextVerticalAlignment.Center;this._text.DisplayText="";this._text.Font="AldotheApache";this._text.TextSize=128;this._text.Pivot=JuiceboxEngine.GUI.UIDefaults.BottomCenter.$clone();this._text.Anchor=JuiceboxEngine.GUI.UIDefaults.BottomCenter.$clone();this._text.Scale=new JuiceboxEngine.Math.Vector2.$ctor3(.5,.5)}},methods:{AddScore:function(score){this._score=this._score+score|0;JuiceboxEngine.Coroutines.CoroutineManager.StartCoroutine(this.ScoreAnimation(score))},ScoreAnimation:function(addedScore){var $s=0,$jff,$rv,$ae,$en=new H5.GeneratorEnumerator(H5.fn.bind(this,function(){try{for(;;)switch($s){case 0:return $en.current=new JuiceboxEngine.Coroutines.WaitForCoroutine.$ctor1(JuiceboxEngine.Coroutines.DefaultRoutines.Linear(.25,H5.fn.bind(this,function(x){this._text.Scale=JuiceboxEngine.Math.Vector2.Interpolate(new JuiceboxEngine.Math.Vector2.$ctor3(.5,.5),new JuiceboxEngine.Math.Vector2.$ctor3(1,1),x)}))),$s=1,!0;case 1:return $en.current=new JuiceboxEngine.Coroutines.WaitForCoroutine.$ctor1(JuiceboxEngine.Coroutines.DefaultRoutines.Linear(1,H5.fn.bind(this,function(x){this._displayedScore=this._score+H5.Int.clip32(JuiceboxEngine.Math.JMath.Interpolate(0,addedScore,x))|0;this._text.DisplayText=H5.toString(this._displayedScore)}))),$s=2,!0;case 2:return $en.current=new JuiceboxEngine.Coroutines.WaitForCoroutine.$ctor1(JuiceboxEngine.Coroutines.DefaultRoutines.Linear(.25,H5.fn.bind(this,function(x){this._text.Scale=JuiceboxEngine.Math.Vector2.Interpolate(new JuiceboxEngine.Math.Vector2.$ctor3(1,1),new JuiceboxEngine.Math.Vector2.$ctor3(.5,.5),x)}))),$s=3,!0;case 3:default:return!1}}catch($ae1){$ae=System.Exception.create($ae1);throw $ae;}}));return $en},SetScoreDisplay:function(score){this._text.DisplayText=score}}});H5.define("LD51.TimerUI",{inherits:[JuiceboxEngine.GUI.EmptyUIElement],fields:{_canvasTextTimer:null},ctors:{ctor:function(parent){this.$initialize();JuiceboxEngine.GUI.EmptyUIElement.ctor.call(this,parent);this.Dimensions=new JuiceboxEngine.Math.Vector2.$ctor3(256,64);this._canvasTextTimer=new JuiceboxEngine.GUI.CanvasText(this);this._canvasTextTimer.DisplayText=" ";this._canvasTextTimer.Dimensions=this.Dimensions.$clone();this._canvasTextTimer.Anchor=JuiceboxEngine.GUI.UIDefaults.Centered.$clone();this._canvasTextTimer.Pivot=JuiceboxEngine.GUI.UIDefaults.Centered.$clone();this._canvasTextTimer.Font="AldotheApache";this._canvasTextTimer.TextSize=64;this._canvasTextTimer.Scale=new JuiceboxEngine.Math.Vector2.$ctor3(.5,.5)}},methods:{UpdateTime:function(time){this._canvasTextTimer.DisplayText=System.TimeSpan.fromSeconds(time).toString("ss.fff");this._canvasTextTimer.Color=time<3?JuiceboxEngine.Math.Color.Red.$clone():JuiceboxEngine.Math.Color.White.$clone()},UpdateElement:function(){}}})});